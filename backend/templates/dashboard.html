<!DOCTYPE html>
<html>
<head>
    <title>Smart Home - Dashboard</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="welcome-section">
        <h2>ğŸ  Smart Home Dashboard</h2>
        <p>Welcome, {{ user["user_name"] }}!</p>
        <p>Your Role: <strong>{{ user["user_role"] }}</strong></p>
    </div>

    <!-- Edit Profile Section -->
    <div class="dashboard-section">
        <h3>ğŸ‘¤ Edit Profile</h3>
        <form action="/update_password" method="post">
            <input type="hidden" name="target_user_id" value="{{ user['user_id'] }}">
            <input type="hidden" name="user_name" value="{{ user['user_name'] }}">
            
            <div class="form-group">
                <label for="new_user_password">New Password:</label>
                <input type="password" id="new_user_password" name="new_user_password" required>
            </div>
            
            <button type="submit">Change Password</button>
        </form>
    </div>

    <!-- Admin Section -->
    {% if user["user_role"] == "admin" %}   
    <div class="dashboard-section">
        <h3>ğŸ‘¥ Manage Users</h3>
        
        {% for u in all_users %}    
        <div class="user-card">
            <h4>{{ u["user_name"] }} <span style="color: var(--text-secondary); font-size: 0.9rem;">({{ u["user_role"] }})</span></h4>
            
            <hr>
            
            <!-- Change Password -->
            <form action="/update_password" method="post">
                <input type="hidden" name="target_user_id" value="{{ u['user_id'] }}">
                <div class="form-group">
                    <label for="new_password_{{ u['user_id'] }}">New Password:</label>
                    <input type="password" id="new_password_{{ u['user_id'] }}" name="new_user_password" placeholder="New Password" required>
                </div>
                <button type="submit" class="btn-secondary">Change Password</button>
            </form>

            <hr>

            <!-- Change Role -->
            <form action="/update_role" method="post" style="display: flex; gap: 1rem; align-items: flex-end;">
                <input type="hidden" name="target_user_id" value="{{ u['user_id'] }}">
                <input type="hidden" name="user_name" value="{{ u['user_name'] }}">
                <div class="form-group" style="flex: 1; margin-bottom: 0;">
                    <label for="new_role_{{ u['user_id'] }}">Change Role:</label>
                    <select id="new_role_{{ u['user_id'] }}" name="new_role">
                        <option value="user" {{ 'selected' if u['user_role'] == 'user' else '' }}>User</option>
                        <option value="admin" {{ 'selected' if u['user_role'] == 'admin' else '' }}>Admin</option>
                    </select>
                </div>
                <button type="submit" class="btn-warning">Update Role</button>
            </form>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Room & Device Management -->
    <div class="dashboard-section">
        <h3>ğŸšª Room & Device Management</h3>
        <a href="/list" class="btn btn-primary">Manage Rooms</a>
    </div>

    <!-- Status & Events -->
    <div class="dashboard-section">
        <h3>ğŸ“Š Status & Events</h3>
        <a href="/status/events" class="btn btn-primary">Device Status & Event Log</a>
    </div>

    <!-- Automation Rules -->
    <div class="dashboard-section">
        <h3>âš™ï¸ Automation Rules</h3>
        <a href="/rules/" class="btn btn-primary">ğŸ”§ Manage Rules</a>
    </div>

    <!-- Logout -->
    <div class="navigation-links">
        <a href="/logout" class="btn btn-danger">Logout</a>
    </div>
</body>
</html>
