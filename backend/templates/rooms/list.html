<!DOCTYPE html>
<html>
<head>
    <title>Smart Home - Rooms</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <h1>üö™ Room Management</h1>
    
    <a href="/create" class="btn btn-create">+ Create New Room</a>

    <div class="rooms-container">
        {% for room in rooms %}
        <div class="room-card">
            <h3>{{ room["room_name"] }}</h3>
            
            <a href="/devices/list/room?room_id={{ room['room_id'] }}">
                üì± View Devices
            </a>

            <hr>

            <!-- Rename Room -->
            <form action="/rename" method="post">
                <input type="hidden" name="room_id" value="{{ room['room_id'] }}">
                <div class="form-group">
                    <label for="new_name_{{ room['room_id'] }}">Rename Room:</label>
                    <input type="text" id="new_name_{{ room['room_id'] }}" name="new_name" placeholder="New Room Name" required>
                </div>
                <button type="submit" class="btn-warning">Rename</button>
            </form>

            {% if user["user_role"] == "admin" %}
            <hr>
            
            <!-- Assign User to Room -->
            <form action="/assign_user" method="post">
                <input type="hidden" name="room_id" value="{{ room['room_id'] }}">
                <div class="form-group">
                    <label for="user_id_{{ room['room_id'] }}">Assign User:</label>
                    <select id="user_id_{{ room['room_id'] }}" name="user_id" required>
                        <option value="" disabled selected>-- Select User --</option>
                        {% for u in all_users %}
                        <option value="{{ u['user_id'] }}">{{ u['user_name'] }} ({{ u['user_role'] }})</option>
                        {% endfor %}
                    </select>
                </div>
                <button type="submit" class="btn-success">Assign User</button>
            </form>

            <!-- Show Assigned Users -->
            {% if room["assigned_users"] %}
            <div style="margin-top: 1rem; padding: 0.75rem; background: #f8fafc; border-radius: var(--radius);">
                <strong style="font-size: 0.875rem; color: var(--text-secondary);">Assigned users:</strong>
                <div style="margin-top: 0.5rem;">
                    {% for au in room["assigned_users"] %}
                    <div style="display: inline-flex; align-items: center; gap: 0.5rem; margin: 0.25rem; padding: 0.25rem 0.5rem; background: white; border-radius: var(--radius); border: 1px solid var(--border-color);">
                        <span style="font-size: 0.875rem;">{{ au["user_name"] }}</span>
                        <form action="/unassign_user" method="post" style="display: inline; margin: 0; padding: 0;">
                            <input type="hidden" name="room_id" value="{{ room['room_id'] }}">
                            <input type="hidden" name="user_id" value="{{ au['user_id'] }}">
                            <button type="submit" style="padding: 0.125rem 0.375rem; font-size: 0.75rem; background: var(--danger-color); color: white; border: none; border-radius: 4px; cursor: pointer;">‚úï</button>
                        </form>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            {% endif %}

            <hr>

            <!-- Delete Room -->
            <form action="/delete" method="post">
                <input type="hidden" name="room_id" value="{{ room['room_id'] }}">
                <button type="submit" class="btn-danger">üóëÔ∏è Delete Room</button>
            </form>
        </div>
        {% endfor %}
    </div>

    <div class="navigation-links">
        <a href="/dashboard">‚Üê Back to Dashboard</a>
    </div>
</body>
</html>
